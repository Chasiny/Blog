# redis过期键删除策略

一般过期删除的策略有三种，如下
## 定时删除

当创建了一个设置了过期的键，同时需要为他创建相应的定时器用于删除该键。

**优点**
* 定时删除可以及时删除过期键并释放该过期键的内存

**缺点**
* 过期键比较多的情况下会占用相当一部分CPU时间，在内存不紧张但是CPU时间非常紧张的情况下，将CPU时间用在删除和当前任务无关的过期键上，会给服务器的响应时间和吞吐量造成影响。
* 创建一个定时器需要用到redis的时间事件，redis使用无序链表实现，查找一个事件的时间复杂度为O(N)，并不能高效处理大量的时间事件。

## 惰性删除
程序只会在取出键进行过期检查

**优点**
* 删除的目标仅限于当前处理的键，这个策略不会在其他无关的过期键上花费任何CPU时间。

**缺点**
* 当存在许多过期键，而且他们也许永远不会被访问到，那么他们将永远不会被删除，将会一直占用大量内存空间

## 定期删除
定期删除策略是前两种的整合和折中：  
定期删除策略每隔一段时间执行一次删除过期键的操作，并通过限制删除执行的时长和频率来减少删除操作对CPU时间的影响。  

**优点**
* 通过限制删除执行的时长和频率来减少删除操作对CPU时间的影响。

**缺点**
* 难以确定删除操作执行的时长和频率

1. 如果删除操作执行得太频繁，或者执行的时间太长，定期删除策略就会退化成定时删除策略
2. 如果删除操作执行得太少，或者执行时间太短，定期删除也会和惰性删除一样，出现浪费内存的情况


# redis的过期键删除策略
redis时间使用的是惰性删除和定期删除两种策略：通过配合使用这两种删除策略，服务器可以很好的在合理使用CPU时间和避免浪费内存空间之间取得平衡。